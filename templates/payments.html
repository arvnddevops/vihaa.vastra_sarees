{% extends 'base.html' %}
{% block content %}
<h3>Payments</h3>

<!-- KPI Cards -->
<div class="row g-3 mb-3">
  <div class="col-md-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-muted">Total Paid</div>
        <div class="fs-3 fw-bold">₹ {{ paid_total|inr }}</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <div class="text-muted">Pending Amount</div>
        <div class="fs-3 fw-bold">₹ {{ pending_total|inr }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Charts -->
<div class="row g-4 mb-3">
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">Payment Mode (Donut)</div>
      <div class="card-body">
        <canvas id="donut"></canvas>
        <!-- removed tiny totals here since KPI cards cover it -->
      </div>
    </div>
  </div>
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">Monthly Totals (Paid)</div>
      <div class="card-body"><canvas id="monthlyPaid"></canvas></div>
    </div>
  </div>
</div>

<div class="table-responsive">
<table class="table table-striped">
  <thead><tr><th>Date</th><th>Order</th><th>Customer</th><th>Amt</th><th>Purchase</th><th>Payment</th><th>Mode</th><th>Delivery</th></tr></thead>
  <tbody>
    {% for o in items %}
      <tr>
        <td>{{ o.date }}</td>
        <td>{{ o.order_id }}</td>
        <td>{{ o.customer.code }} - {{ o.customer.name }}</td>
        <td>₹ {{ o.amount|inr }}</td>
        <td>{{ o.purchase }}</td>
        <td class="{{ 'text-danger' if o.payment_status=='Pending' else 'text-success' }}">{{ o.payment_status }}</td>
        <td>{{ o.payment_mode }}</td>
        <td>{{ o.delivery_status }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
</div>

<script>
  window.__donut = {{ donut|tojson }};
  window.__monthlyPaid = {{ monthly_chart|tojson }};
</script>
{% endblock %}
